GET /_search
{
    "query": {

        "match": {

            "event_type" : "bro_dns"

        }

    },
    "script_fields" : {
        "test1" : {
            "script" : {
                "lang": "painless",
                "source": """
                if (doc.containsKey("subdomain.keyword")&&!doc["subdomain.keyword"].empty){
                
                def subdomainStr=doc["subdomain.keyword"].value;
                def length=doc["subdomain_length"].value;
                
                char[] subdomainArr;
                subdomainArr=subdomainStr.toCharArray();
                def out=subdomainArr[1].toString();
                char x=1;
                Map Counts= new HashMap();
                char c;
                for (int i=0;i<length;i++)
                {
                c=subdomainArr[i];
                if (Counts.containsKey(c)){
                  Counts.put(c, Counts.get(c)+1);
                }
                else {
                  Counts.put(c,1);
                }
                }
                
                double entropy=0;
                double p;
                double logp;
                double pent;
                char currentChar;
                double dlength=length;
                def uniqueCs=Counts.keySet().toArray();
                for (int i=0;i<uniqueCs.length;i++){
                currentChar=uniqueCs[i];
                p=Counts.get(currentChar)/dlength;
                logp=Math.log(p)/Math.log(2);
                pent=p*logp;
                entropy=entropy-pent;
                }
                
                
                return entropy;
                }
                else{
                  return null;
                }
                """
            }
        }
    }
}
